---
import "../styles/global.css";
import { ViewTransitions } from "astro:transitions";
import {
  LayoutDashboard,
  Languages,
  BookOpen,
  ScrollText,
  Users,
  Settings,
  LogOut,
} from "lucide-react";

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} - Admin Nihongoin</title>
    <ViewTransitions />
  </head>
  <body
    class="bg-canvas text-ink font-sans antialiased selection:bg-brand-neon selection:text-ink"
  >
    <div class="flex h-screen overflow-hidden">
      <!-- Mobile Header -->
      <div
        class="lg:hidden fixed top-0 left-0 right-0 z-50 h-16 flex items-center justify-between px-4 bg-canvas border-b border-border-line"
      >
        <a
          href="/admin/dashboard"
          class="flex items-center gap-2 font-black text-xl uppercase tracking-tighter"
        >
          <div
            class="w-8 h-8 bg-brand-neon flex items-center justify-center border border-ink"
          >
            <span class="text-sm">IN</span>
          </div>
          <span class="text-ink">Admin</span>
        </a>
        <button
          id="admin-menu-btn"
          class="flex h-10 w-10 items-center justify-center border border-border-line bg-canvas text-ink hover:bg-surface transition-colors"
          aria-label="Open menu"
        >
          <svg
            class="h-5 w-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="square"
              stroke-linejoin="miter"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      <!-- Sidebar -->
      <aside
        id="admin-sidebar"
        class="fixed lg:relative inset-y-0 left-0 z-40 w-72 flex-shrink-0 border-r border-border-line bg-canvas flex flex-col justify-between transform -translate-x-full lg:translate-x-0 transition-transform duration-300"
      >
        <div class="flex flex-col h-full">
          <!-- Logo -->
          <div
            class="flex h-20 items-center px-8 border-b border-border-line bg-canvas"
          >
            <a
              href="/admin/dashboard"
              class="flex items-center gap-3 font-black text-2xl uppercase tracking-tighter group"
            >
              <div
                class="w-10 h-10 bg-brand-neon flex items-center justify-center border-2 border-ink shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] group-hover:translate-x-[2px] group-hover:translate-y-[2px] group-hover:shadow-none transition-all"
              >
                <span class="text-xl text-ink">IN</span>
              </div>
              <span class="text-ink">Nihongoin</span>
            </a>
          </div>

          <!-- Nav -->
          <nav class="flex-1 overflow-y-auto w-full">
            <div class="p-6 border-b border-border-line">
              <a
                href="/admin/dashboard"
                class="flex items-center gap-3 px-4 py-3 text-sm font-bold uppercase tracking-wider text-ink bg-surface border border-border-line hover:bg-ink hover:text-canvas transition-colors"
              >
                <LayoutDashboard className="h-4 w-4" />
                Overview
              </a>
            </div>

            <div class="p-6 space-y-2">
              <p
                class="px-1 mb-4 text-[10px] font-black uppercase tracking-[0.2em] text-subtle"
              >
                Content Management
              </p>

              <a
                href="/admin/kanji"
                class="flex items-center gap-3 px-4 py-3 text-sm font-bold uppercase tracking-wider text-subtle hover:text-ink hover:bg-surface border border-transparent hover:border-border-line transition-all"
              >
                <Languages className="h-4 w-4" />
                Kanji
              </a>
              <a
                href="/admin/kosakata"
                class="flex items-center gap-3 px-4 py-3 text-sm font-bold uppercase tracking-wider text-subtle hover:text-ink hover:bg-surface border border-transparent hover:border-border-line transition-all"
              >
                <BookOpen className="h-4 w-4" />
                Kosakata
              </a>
              <a
                href="/admin/bunpo"
                class="flex items-center gap-3 px-4 py-3 text-sm font-bold uppercase tracking-wider text-subtle hover:text-ink hover:bg-surface border border-transparent hover:border-border-line transition-all"
              >
                <ScrollText className="h-4 w-4" />
                Bunpo
              </a>
              <a
                href="/admin/roadmap"
                class="flex items-center gap-3 px-4 py-3 text-sm font-bold uppercase tracking-wider text-subtle hover:text-ink hover:bg-surface border border-transparent hover:border-border-line transition-all"
              >
                <BookOpen className="h-4 w-4" />
                Roadmap
              </a>
            </div>

            <div class="p-6 border-t border-border-line">
              <p
                class="px-1 mb-4 text-[10px] font-black uppercase tracking-[0.2em] text-subtle"
              >
                System
              </p>
              <a
                href="/"
                target="_blank"
                class="flex items-center gap-3 px-4 py-3 text-sm font-bold uppercase tracking-wider text-subtle hover:text-ink hover:bg-surface border border-transparent hover:border-border-line transition-all"
              >
                <LayoutDashboard className="h-4 w-4" />
                Live Site
              </a>
            </div>
          </nav>

          <!-- User Footer -->
          <div class="border-t border-border-line p-6 bg-canvas">
            <button
              id="logout-btn"
              class="flex w-full items-center justify-center gap-2 px-4 py-3 text-sm font-bold uppercase tracking-wider text-red-600 border border-red-600 bg-red-50 hover:bg-red-600 hover:text-white dark:bg-red-900/10 dark:text-red-400 dark:border-red-800 dark:hover:bg-red-600 dark:hover:text-white transition-all"
            >
              <LogOut className="h-4 w-4" />
              Sign Out
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 overflow-y-auto bg-surface relative pt-16 lg:pt-0">
        <div
          class="absolute inset-0 bg-[linear-gradient(to_right,var(--color-border)_1px,transparent_1px),linear-gradient(to_bottom,var(--color-border)_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)] opacity-20 pointer-events-none"
        >
        </div>
        <div class="max-w-7xl mx-auto p-4 md:p-8 lg:p-12 relative z-10">
          <slot />
        </div>
      </main>
    </div>

    <!-- Auth Check Script -->
    <script>
      import { supabase } from "../lib/supabase";

      // Check if user is logged in
      async function checkAuth() {
        // Simple session check (client-side protection)
        const {
          data: { session },
        } = await supabase.auth.getSession();
        if (!session) {
          // If no session, redirect to login
          window.location.href = "/admin/login";
        }
      }

      checkAuth();

      // Logout handler
      document
        .getElementById("logout-btn")
        ?.addEventListener("click", async () => {
          const { error } = await supabase.auth.signOut();
          if (!error) {
            window.location.href = "/admin/login";
          }
        });

      // Mobile sidebar toggle
      const adminMenuBtn = document.getElementById("admin-menu-btn");
      const adminSidebar = document.getElementById("admin-sidebar");

      adminMenuBtn?.addEventListener("click", () => {
        adminSidebar?.classList.toggle("-translate-x-full");
        adminSidebar?.classList.toggle("translate-x-0");
      });
    </script>
  </body>
</html>
